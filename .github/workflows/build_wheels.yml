# File: .github/workflows/build_wheels.yml

name: Build and Release Wheels

# This workflow runs automatically when you create a new release on GitHub.
on:
  release:
    types: [published]
  # Allows you to run this workflow manually from the Actions tab for testing.
  workflow_dispatch:

jobs:
  build_wheels:
    name: Build wheels on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        # Define the operating systems to build on.
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
      - name: Check out the repository code
        uses: actions/checkout@v4

      # This is the industry-standard action for building portable wheels.
      # It creates isolated environments for each Python version and OS,
      # installs build dependencies, and compiles the code correctly.
      - name: Build wheels with cibuildwheel
        uses: pypa/cibuildwheel@v2.17.0
        # The wheels will be placed in the ./wheelhouse directory.

      # This action takes all the .whl files from the ./wheelhouse directory
      # and uploads them as assets to the GitHub Release that triggered this workflow.
      # This makes them publicly downloadable.
      - name: Upload wheels to GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          # This tells the action to upload all files matching the pattern.
          files: ./wheelhouse/*.whl