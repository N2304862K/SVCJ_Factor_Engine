# File: .github/workflows/build_wheels.yml
# This GitHub Actions workflow automates the process of building the compiled
# wheels for Linux, macOS, and Windows across multiple Python versions.

name: Build Compiled Wheels

# --- Trigger ---
# This workflow runs automatically whenever you create a new release on GitHub.
on:
  release:
    types: [published]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build_wheels:
    name: Build wheel for ${{ matrix.os }} on Python ${{ matrix.python-version }}
    runs-on: ${{ matrix.os }}

    # --- Build Matrix ---
    # Defines all the combinations of Operating Systems and Python versions
    # that the wheels will be built for.
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        python-version: ["3.8", "3.9", "3.10", "3.11", "3.12"]

    steps:
      # 1. Check out the repository code
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. Set up the specific Python version for the current job
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      # 3. Install build dependencies
      # This step ensures pip, wheel, and the build requirements from pyproject.toml
      # are installed before the build starts.
      - name: Install build dependencies
        run: |
          python -m pip install --upgrade pip
          pip install wheel

      # 4. Build the wheel
      # This command tells pip to build a wheel for the project in the current directory (.)
      # and place the resulting .whl file into a directory named "wheels".
      - name: Build wheel
        run: |
          pip wheel . --wheel-dir ./wheels

      # 5. Upload the compiled wheel as an artifact
      # This step saves the generated .whl file from the temporary runner machine
      # and makes it available for download on the GitHub Actions summary page.
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: wheels-${{ matrix.os }}-${{ matrix.python-version }}
          path: ./wheels